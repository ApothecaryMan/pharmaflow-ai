@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@100..700&display=swap");
@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100..700&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Roboto+Flex:GRAD,XTRA,YOPQ,YTAS,YTDE,YTFI,YTLC,YTUC,opsz,slnt,wdth,wght@-200..150,323..603,25..135,649..854,-305..-98,560..788,416..570,528..760,8..144,-10..0,25..151,100..1000&display=swap");
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 
   --- Script Firewall: Unicode Proxy Strategy ---
   We define virtual font families that restrict system fonts to specific character ranges.
   This prevents "greedy" fonts (like Segoe UI) from stealing Arabic rendering,
   and prevents Arabic fonts from stealing English rendering.
*/

/* Latin/English Proxy */
@font-face {
  font-family: "En-Firewall";
  src: local("-apple-system"), local("BlinkMacSystemFont"), local("Segoe UI"), local("Roboto"), local("Helvetica Neue"), local("Arial"), local("sans-serif");
  /* Latin, Latin-ext, and common symbols only */
  unicode-range: U+0000-00FF, U+0100-024F, U+0259, U+1E00-1EFF, U+2000-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
}

/* Arabic Proxy */
@font-face {
  font-family: "Ar-Firewall";
  src: local("Segoe UI"), local("Tahoma"), local("Arial"), local("sans-serif");
  /* Arabic, Arabic Supplement, Presentation Forms A/B */
  unicode-range: U+0600-06FF, U+0750-077F, U+08A0-08FF, U+FB50-FDFF, U+FE70-FEFF;
}

/* Define structural variables for Recharts/SVG usage */
:root {
  --border-color: #e5e7eb; /* gray-200 */
  --text-secondary: #6b7280; /* gray-500 */
  --font-en: "Inter";
  --font-ar: "Cairo";
}

.dark {
  --border-color: #374151; /* gray-700 */
  --text-secondary: #9ca3af; /* gray-400 */
}

/* PWA Styles - iOS/iPad Safe Areas & Standalone Mode */
@supports (padding: env(safe-area-inset-top)) {
  body {
    /* Handle notch/home indicator safe areas */
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}

/* Prevent iOS rubber-band scrolling on the body */
html,
body {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

/* Scroll Lock for Mobile Drawer/Modals */
.drawer-open,
.drawer-open html,
.drawer-open body {
  overflow: hidden !important;
}

.drawer-open .main-content-scroll {
  overflow: hidden !important;
  touch-action: none !important;
}

/* PWA Standalone Mode Detection */
@media (display-mode: standalone) {
  /* Add any standalone-specific styles here */
  body {
    /* Slightly different styling when running as PWA */
  }
}

/* Prevent text selection on UI elements (PWA feel) */
.no-select {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Global Disabled Button Styling */
button:disabled,
.btn-disabled {
  cursor: default !important;
  pointer-events: none !important;
  opacity: 0.5;
}

@layer utilities {
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: theme("colors.gray.300") transparent;
  }
  .dark .custom-scrollbar {
    scrollbar-color: theme("colors.gray.700") transparent;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-700;
    border-radius: 20px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-600;
  }

  .custom-scrollbar::-webkit-scrollbar-button {
    display: none;
  }
}

/* --- Real-Time Sales Animations --- */
@keyframes slideIn {
  0% {
    opacity: 0;
    transform: perspective(1000px) rotateX(-10deg) translateY(-20px) scale(0.95);
    background-color: rgba(16, 185, 129, 0.4);
    box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.2);
  }
  60% {
    transform: perspective(1000px) rotateX(2deg) translateY(4px) scale(1.01);
  }
  80% {
    transform: perspective(1000px) rotateX(0deg) translateY(-1px) scale(0.99);
  }
  100% {
    opacity: 1;
    transform: perspective(1000px) rotateX(0) translateY(0) scale(1);
    background-color: transparent;
    box-shadow: none;
  }
}

.new-transaction {
  animation: slideIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  will-change: transform, opacity, background-color;
  position: relative;
  z-index: 10;
}

/* YouTube-style Roll Up Animation for Order ID */
@keyframes rollUp {
  0% {
    transform: translateY(100%);
    opacity: 0;
  }
  30% {
    opacity: 1;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes pulse-green {
  0%,
  100% {
    color: inherit;
  }
  50% {
    color: #22c55e;
  }
}

@keyframes loading {
  from {
    width: 0%;
  }
  to {
    width: 100%;
  }
}

/* --- Toast Animations --- */
@keyframes toast-in {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes toast-out {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}

@keyframes toast-progress {
  from {
    width: 100%;
  }
  to {
    width: 0%;
  }
}

/* Custom Card Shadow (User Request 2025-12-09) */
/* Light Mode Only Override */
html:not(.dark) .card-shadow {
  box-shadow: none !important;
  border: 2px solid #e5e7eb !important;
}

/* --- Roboto Flex Variable Typography System --- */
:root {
  /* Core Axes Defaults */
  --font-weight: 400; /* wght: 100-1000 */
  --font-width: 100; /* wdth: 50-150 (approx, standard is 100) */
  --font-grade: 0; /* GRAD: -200 to 150 */

  /* Semantic Weight Tokens */
  --weight-calm: 350; /* Lighter, airy */
  --weight-functional: 400; /* Standard, readable */
  --weight-medium: 500; /* Structured */
  --weight-bold: 650; /* Emphatic but not heavy */

  /* Semantic Width Tokens */
  --width-compact: 95; /* Efficient for data */
  --width-standard: 100; /* Normal reading */
  --width-expressive: 110; /* Wider for headlines/hero */

  /* Semantic Grade Tokens */
  --grade-soft: -25;
  --grade-neutral: 0;
  --grade-strong: 20;

  /* Slant Axis */
  --font-slant: 0;

  /* Advanced Axes (Roboto Flex) */
  --font-xtra: 468; /* Parametric Grade (Thickness) 323..603 */
  --font-yopq: 79; /* Thin Stroke 25..135 */
  --font-ytas: 750; /* Ascender Height 649..854 */
  --font-ytde: -203; /* Descender Depth 98..305 */
  --font-ytfi: 738; /* Figure Height 560..788 */
  --font-ytlc: 514; /* Lowercase Height 416..570 */
  --font-ytuc: 712; /* Uppercase Height 528..760 */
  
  /* Cross-Script Harmonization */
  --ar-scale: 0.485; /* Precision aspect ratio for IBM Plex Sans Arabic vs Roboto Flex */
  --ar-offset-y: -0.05em; /* Vertical alignment offset */
}

/* Dark Mode Typography Optimization */
/* Thins the font slightly (-25 grade) to counter the "irradiation illusion" where white text looks thicker */
.dark body {
  --grade-neutral: -25;
  --font-grade: -25;
}

/* --- IBM Plex Sans Arabic (Variable) --- */
/* Loaded via @import at the top of the file to ensure valid source URL */

/* Global Typography Reset */
/* Global Typography Reset & Script Firewall */
body {
  font-family:
    var(--font-en),          /* 1. Latin Firewall (Restricted to Latin) */
    var(--font-ar),          /* 2. Arabic Firewall (Restricted to Arabic) */
    "En-Firewall",           /* 3. Global Latin Safety */
    "Ar-Firewall",           /* 4. Global Arabic Safety */
    sans-serif;

  /* Enable Native Browser Optical Sizing */
  font-optical-sizing: auto;

  /* Bind Axes to Variables */
  font-variation-settings:
    "wght" var(--font-weight),
    "wdth" var(--font-width),
    "GRAD" var(--font-grade),
    "slnt" var(--font-slant),
    "XTRA" var(--font-xtra),
    "YOPQ" var(--font-yopq),
    "YTAS" var(--font-ytas),
    "YTDE" var(--font-ytde),
    "YTFI" var(--font-ytfi),
    "YTLC" var(--font-ytlc),
    "YTUC" var(--font-ytuc);

  /* Smooth "Breathe" Transitions */
  transition: font-variation-settings 0.3s cubic-bezier(0.2, 0, 0, 1);

  /* Rendering optimizations */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 
   RTL Configuration 
   Note: We DO NOT override font-family here anymore. 
   The body stack above handles both scripts automatically (The Firewall Strategy).
*/
html[dir="rtl"] body,
html[lang="ar"] body {
  /* Cross-Script Harmonization: Scale Arabic text */
  font-size-adjust: var(--ar-scale); 
}

/* Arabic Headings & Active UI - Inherit Full Firewall Stack */
html[dir="rtl"] h1,
html[dir="rtl"] .h1,
html[dir="rtl"] h2,
html[dir="rtl"] .h2,
html[dir="rtl"] h3,
html[dir="rtl"] .h3,
html[dir="rtl"] h4,
html[dir="rtl"] .h4,
html[dir="rtl"] h5,
html[dir="rtl"] .h5,
html[dir="rtl"] h6,
html[dir="rtl"] .h6,
html[dir="rtl"] nav,
html[lang="ar"] h1,
html[lang="ar"] .h1,
html[lang="ar"] h2,
html[lang="ar"] .h2,
html[lang="ar"] h3,
html[lang="ar"] .h3,
html[lang="ar"] h4,
html[lang="ar"] .h4,
html[lang="ar"] h5,
html[lang="ar"] .h5,
html[lang="ar"] h6,
html[lang="ar"] .h6,
html[lang="ar"] nav {
  font-family:
    var(--font-en),
    var(--font-ar),
    "En-Firewall",
    "Ar-Firewall",
    sans-serif;
}

/* Adjust padding/height for Arabic Navigation to accommodate font weight/size */
html[dir="rtl"] nav .main-nav-tab,
html[lang="ar"] nav .main-nav-tab {
  padding-top: 0.4rem !important;
  padding-bottom: 0.4rem !important;
  line-height: 1.5 !important;
}

/* --- Contextual Typography Classes --- */

/* 1. Calm: For backgrounds, secondary text, relaxed reading */
.type-calm {
  --font-weight: var(--weight-calm);
  --font-width: var(--width-standard);
  --font-grade: var(--grade-soft);
  /* opsz handled automatically */
}

/* 2. Functional: For data tables, inputs, dense UI */
.type-functional {
  --font-weight: var(--weight-functional);
  --font-width: var(--width-compact);
  --font-grade: var(--grade-neutral);
  /* opsz handled automatically */
}

/* 3. Interactive: For buttons, tabs, links */
.type-interactive {
  --font-weight: var(--weight-medium);
  --font-width: var(--width-standard);
  --font-grade: var(--grade-neutral);
  /* opsz handled automatically */
  cursor: pointer;
}
/* Micro-interaction: Grade shift on hover for "tactile" feel */
.type-interactive:hover {
  --font-grade: 50;
}

/* 4. Expressive: For headlines, hero sections, modal titles */
.type-expressive {
  --font-weight: var(--weight-bold);
  --font-width: var(--width-expressive);
  --font-grade: var(--grade-neutral);
  /* opsz handled automatically */
}

/* --- Automatic Heading Hierarchy --- */
/* We no longer force opsz, browser does it better */
h1,
.h1 {
  --font-weight: 600;
  --font-width: 110;
}
h2,
.h2 {
  --font-weight: 550;
  --font-width: 105;
}
h3,
.h3 {
  --font-weight: 500;
  --font-width: 100;
}

/* Ensure standard bold utilities still work by mapping them if needed, 
   though font-variation-settings usually overrides font-weight.
   We force the variable update for these utility classes. */
.font-bold {
  --font-weight: 700;
}
.font-medium {
  --font-weight: 500;
}
.font-semibold {
  --font-weight: 600;
}
.font-light {
  --font-weight: 300;
}

/* Force Arabic Bold Buttons - Using Full Firewall Stack */
html[dir="rtl"] .font-bold,
html[lang="ar"] .font-bold {
  font-weight: 700 !important;
  font-family:
    var(--font-en),
    var(--font-ar),
    "En-Firewall",
    "Ar-Firewall",
    sans-serif;
}

/* --- Mobile Dock Fluid Animation --- */
.transition-fluid {
  transition-property: all;
  transition-timing-function: cubic-bezier(0.32, 0.72, 0, 1);
  transition-duration: 0.4s;
}

@keyframes wordEntrance {
  from {
    opacity: 0;
    transform: translateY(4px);
    filter: blur(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }
}

.animate-word-entrance {
  animation: wordEntrance 0.4s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}




.mask-fade-edges {
  mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.animate-scale-in {
  animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}
